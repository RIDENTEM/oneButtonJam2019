pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
px = 60
py = 40
lx1=0
ly1=127
lx2=127
ly2=0

ob1= {ox=0,oy=0,ovx=0,ovy=g}
ob2= {ox=0,oy=0,ovx=0,ovy=g}
obstacles={ob1,ob2}


ended=false
start=true
jumping = false
score=0

function bounce(o)
--o.ovy=0
o.ovx-=rnd(2.5,3.0)
o.ovy-=rnd(2.5,4.5)
end

function respawnObstacle(o)
a=0
a+=5
o.ox=100+a
o.oy=10
o.ovx=-0.5
o.ovy=0.1

end


function _init()
grounded = false
g=0.1
pvelocity= {pvx=0,pvy=g}
 for o in all (obstacles) do
respawnObstacle(o)
end
end

function _draw()
cls()

--main menu
if(start) then
print("MOUNTAIN CLIMBER",35,66)
print("PRESS ⬆️ TO PLAY!",35,75)
end
if(ended) print("PRESS ⬆️ to retry", 35, 75) print("SCORE: ",35,85) print(score,60,85)

if(start==false and ended==false)
then
 print(score)
 --draw mountain
 line(lx1,ly1,lx2,ly2,6)
 --Player here
 circfill(px,py, 1,3)
--Obstacle here
 for o in all (obstacles) do
 circfill(o.ox,o.oy,3,5)
 end
 end
end

function _update()
  _input()
 if(start==false and ended==false)
 then
   score+=1/30

   if(grounded ==false) updatePlayerMovement()
   if(grounded) slide()
   updateObstacleMovement()
   if(px < 10 or py>127) died()
   check_collision(true,px,py)
   for o in all (obstacles) do
    if(o.ox+o.oy>=123) o.ovy=0 bounce(o)
    check_collision(false,o.ox,o.oy)
    if(o.ox<=0) respawnObstacle(o)
   end
  end
end

function updatePlayerMovement()
  px+=pvelocity.pvx
  py+=pvelocity.pvy
pvelocity.pvy+=g
end

function updateObstacleMovement()
 for o in all (obstacles) do
o.ovy+=g
o.ox+=o.ovx
o.oy+=o.ovy
end
end

function on_grounded()
start=false
 grounded=true
 pvelocity.pvx=0
 pvelocity.pvy=0
end

function on_ungrounded()
 py-=4
 grounded=false
 jumping=true
end

function died()
ended=true
end

--Update this to work for obstacles
function check_collision(isPlayer,x,y)
 if(isPlayer and x+y>=125)on_grounded()
 if(isPlayer==false and((px>x-3 and px<x+3)and (py>y-3 and py<y+3))) died()
end

function _input()
 if(btnp(2) and start) start=false
 if(btnp(2)and ended) respawn()
if(btnp(2)and grounded) then
on_ungrounded()
  jump()
  end
end


--Need to make sure the player can jump while grounded
function jump()
 pvelocity.pvx+=1
 pvelocity.pvy-=2
end

function slide()
 px-=1
 py+=1
end

function respawn()
for o in all (obstacles) do
respawnObstacle(o)
end
score=0
ended=false
 on_ungrounded()
 pvelocity.pvx=0
 pvelocity.pvy=0.5
 px=60
 py=40

end




__gfx__
00000000000000060066666666dd6dd6000000060000000666d6dddd6666bbdd0000000000000000000000000000000000000000000000000000000000000000
0000000000000066066666666dddda6d00000066000000066d66dddd6bdbbbdd0000000000000000000000000000000000000000000000000000000000000000
007007000000066466666666dd886ddd00000066000066d66d6dd6ddbbdddbbb0000000000000000000000000000000000000000000000000000000000000000
000770000000664b666666666a6dddda0000066d000666d6d6dd6dd6bddbbbdd0000000000000000000000000000000000000000000000000000000000000000
00077000000664b466666666adddd866000066dd06666d6dddd6dd6dddbbdbdd0000000000000000000000000000000000000000000000000000000000000000
0070070000664bbb66666666dadd86660066dddd666ddddddd6dd6ddbbbdbbd60000000000000000000000000000000000000000000000000000000000000000
000000000664444b66666666dd888a6d06dd6ddd66ddddddd66d6dddd6bdbdd60000000000000000000000000000000000000000000000000000000000000000
000000006644bb4466666666d866add66ddddddd6dd6d66dd6dddd6dd6d6bd660000000000000000000000000000000000000000000000000000000000000000
__label__

__map__
1414141414140000080800001717171400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1414141414100808080808080817171400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000101010080808080808171717141400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1717171717171717040817171717171700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0017171717171705061717171400141400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1710171717170407071717000014001400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1717171717050303071414000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010080817170703170014141400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000808000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
