pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
px = 60
py = 40
lx1=0
ly1=127
lx2=127
ly2=0

obstacle= {grounded=false,
ox=0,oy=0,ovx=0,ovy=g}

obstacles={}

first_jump_avail = false
double_jump_avail = false
start=true
jumping = false

function bounce()
print("bounce")
obstacle.ovx-=rnd(0.1,1.5)
obstacle.ovy-=rnd(1.0,1.5)
obstacle.grounded=false
end

function respawnObstacle()
obstacle.ox=100
obstacle.oy=10
obstacle.ovx=-0.5
obstacle.ovy=1
obstacle.grounded=false
end


function _init()
grounded = false
g=0.1
pvelocity= {pvx=0,pvy=g}
respawnObstacle()
end

function _draw()

cls()
print(obstacle.grounded)
--draw mountain
line(lx1,ly1,lx2,ly2,6)
--[[for j=0, 127 do
 for i=0,127 do
  if(pget(i,j)==6) then
  pset(i+1,j,6)
  end
 end
end--]]

--Player here
circfill(px,py, 1,3)
--Obstacle here
circfill(obstacle.ox,obstacle.oy,2,5)

end

function _update()
 _input()
if(grounded ==false) updatePlayerMovement()
--if(obstacleTouchedGround)
updateObstacleMovement()
respawn()
check_collision(true,px,py)
check_collision(false,obstacle.ox,obstacle.oy)
if(grounded) slide()
end

function updatePlayerMovement()
  px+=pvelocity.pvx
  py+=pvelocity.pvy
pvelocity.pvy+=g
end

function updateObstacleMovement()
obstacle.ovy+=g
obstacle.ox+=obstacle.ovx
obstacle.oy+=obstacle.ovy

end

function on_grounded()
start=false
 grounded=true
 first_jump_avail=true
 second_jump_avail=false
end

function on_ungrounded()
 grounded=false
 jumping=true
end

--Update this to work for obstacles
function check_collision(isPlayer,x,y)

 if(isPlayer and pget(x+1,y+1)==6) on_grounded()
if(isPlayer==false and x+y>126) bounce()
end

function _input()
if(btnp(2)) then
on_ungrounded()
 if(first_jump_avail)
  then
  jump(first_jump_avail)
  first_jump_avail=false
  second_jump_avail=true
  end
 if(second_jump_avail)
  then
  first_jump_avail=false
  second_jump_avail=false
     jump(first_jump_avail)
  end
 end
end


--Need to make sure the player can jump while grounded
function jump(is_first)
 if(is_first) pvelocity.pvy-=2

 if(is_first==false)
 then
 pvelocity.pvx+=1
 --Problem with this, this is the first jump that goes
 pvelocity.pvy-=2
 end

end

function slide()
 px-=1
 py+=1
end

function respawn()
if(px < 10)
 then
 on_ungrounded()
 px=60
 py=40
 end
end




__gfx__
00000000000000060066666666dd6dd6000000060000000666d6dddd6666bbdd0000000000000000000000000000000000000000000000000000000000000000
0000000000000066066666666dddda6d00000066000000066d66dddd6bdbbbdd0000000000000000000000000000000000000000000000000000000000000000
007007000000066466666666dd886ddd00000066000066d66d6dd6ddbbdddbbb0000000000000000000000000000000000000000000000000000000000000000
000770000000664b666666666a6dddda0000066d000666d6d6dd6dd6bddbbbdd0000000000000000000000000000000000000000000000000000000000000000
00077000000664b466666666adddd866000066dd06666d6dddd6dd6dddbbdbdd0000000000000000000000000000000000000000000000000000000000000000
0070070000664bbb66666666dadd86660066dddd666ddddddd6dd6ddbbbdbbd60000000000000000000000000000000000000000000000000000000000000000
000000000664444b66666666dd888a6d06dd6ddd66ddddddd66d6dddd6bdbdd60000000000000000000000000000000000000000000000000000000000000000
000000006644bb4466666666d866add66ddddddd6dd6d66dd6dddd6dd6d6bd660000000000000000000000000000000000000000000000000000000000000000
__map__
1414141414140000080800001717171400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1414141414100808080808080817171400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000101010080808080808171717141400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1717171717171717040817171717171700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0017171717171705061717171400141400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1710171717170407071717000014001400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1717171717050303071414000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010080817170703170014141400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000808000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
